# DeadEndRatioRule文档

## 概述

DeadEndRatioRule已更新为使用**纯客观评分方法**，评估地图中死胡同的比例，完全基于数学原理，无任何主观权重。

## 设计理念

### 客观性
- 完全基于图论原理
- 无主观权重分配
- 使用简单的线性关系：score = 1 - dead_end_ratio

### 子指标

#### 1. Dead End Ratio（死胡同比例）
- **定义**: 度数为1的节点占总房间数的比例
- **范围**: [0, 1]
- **意义**: 衡量地图中死胡同的密度

#### 2. Average Dead End Length（平均死胡同长度，可选）
- **定义**: 沿叶节点唯一路径追溯到分岔点的平均深度
- **意义**: 衡量死胡同的深度

### 评分方法

使用**纯客观线性关系**：

```
score = 1.0 - dead_end_ratio
```

- 死胡同越少，评分越高
- 完全线性关系，无任何主观调整

## 技术实现

### 核心算法

1. **图构建**
   - 基于connections构建无向图
   - 计算每个节点的度数

2. **死胡同识别**
   - 度数为1的节点即为死胡同
   - 统计死胡同数量和比例

3. **可选长度分析**
   - 追溯死胡同路径到分岔点
   - 计算平均路径长度

### 代码结构

```python
class DeadEndRatioRule(BaseQualityRule):
    def __init__(self, include_length=False):
        # 初始化，可选择是否包含长度分析
        
    def evaluate(self, dungeon_data):
        # 1. 构建图结构
        # 2. 计算度数
        # 3. 识别死胡同
        # 4. 计算比例
        # 5. 可选长度分析
        # 6. 返回客观评分
        return score, details
```

## 权重设置

- **当前权重**: 0.1（参与主观权重计算）
- **原因**: 虽然使用客观评分，但仍参与整体权重计算
- **影响**: 影响整体质量评分

## 评分示例

### 高质量地图特征
- 死胡同比例 < 0.1（死胡同很少）
- 评分 > 0.9

### 低质量地图特征
- 死胡同比例 > 0.3（死胡同过多）
- 评分 < 0.7

## 可选功能

### 长度分析
通过`include_length=True`参数启用：

```python
rule = DeadEndRatioRule(include_length=True)
score, detail = rule.evaluate(data)
# detail中会包含avg_dead_end_length字段
```

### 长度分析算法
1. **路径追溯**: 从死胡同节点开始
2. **唯一路径**: 沿着度数为1的路径前进
3. **分岔点识别**: 遇到度数>1的节点停止
4. **长度计算**: 统计路径步数

## 优势

1. **完全客观**: 无主观权重，基于纯数学原理
2. **简单明确**: 线性关系，易于理解
3. **高效计算**: 时间复杂度O(V+E)
4. **灵活配置**: 支持可选的长度分析

## 应用场景

- 死胡同密度评估
- 地图探索体验分析
- 路径设计优化建议
- 客观比较不同地图设计

## 技术细节

### 图构建优化
- 使用defaultdict提高效率
- 支持大规模地图处理
- 自动处理双向连接

### 死胡同识别
- 基于度数统计
- 支持复杂图结构
- 处理孤立节点

### 长度分析优化
- 防止无限循环
- 支持复杂分支结构
- 高效路径追溯

### 错误处理
- 处理空图情况
- 处理无效连接
- 处理孤立节点 