# 地下城适配器系统架构图总结

## 概述
本系统是一个模块化的地下城地图格式转换和质量评估框架，采用插件化架构设计，支持多种地下城生成器格式的统一处理。

## 四张核心架构图

### 1. 系统架构总览图
**描述**: 展示整个系统的分层架构和组件关系
**核心特点**:
- **用户界面层**: CLI命令行接口，支持未来API扩展
- **核心管理层**: 适配器管理器、质量评估器、可视化器
- **数据转换层**: 插件化适配器 + 空间推理引擎
- **质量评估层**: 9个评估规则插件
- **数据层**: 统一地下城格式 + 各种源格式

**设计亮点**:
- 分层架构，职责清晰
- 插件化设计，易于扩展
- 统一数据格式，标准化处理

### 2. 插件适配器架构图
**描述**: 详细展示适配器插件的设计模式和实现机制
**核心特点**:
- **适配器管理器**: 动态加载、格式检测、数据转换
- **抽象基类**: 定义统一接口规范
- **具体实现**: 5个适配器支持不同格式
- **统一输出**: 标准化的UnifiedDungeonFormat

**设计亮点**:
- 策略模式实现格式转换
- 动态加载机制，无需修改核心代码
- 统一的接口规范，保证一致性

### 3. 空间推理与图模型流程图
**描述**: 展示空间推理引擎的工作流程和图模型构建过程
**核心特点**:
- **输入处理**: 房间、走廊、连接信息
- **空间推理**: 边界提取、邻接判断、置信度计算
- **图模型构建**: 连接图、拓扑分析、最短路径
- **智能识别**: 语义分析、拓扑规则、空间位置
- **输出增强**: 推断连接、推断门、入口出口识别

**设计亮点**:
- 基于几何的空间推理算法
- 多维度智能识别策略
- 自动补全缺失信息

### 4. 指标计算管道图
**描述**: 展示质量评估的完整计算流程和评分机制
**核心特点**:
- **评估器**: 规则加载、权重配置、质量评估
- **规则管道**: 9个评估规则，分为3个类别
  - 结构规则 (35%): 可访问性、度方差、门分布、环路比例
  - 游戏性规则 (50%): 路径多样性、宝藏怪物分布、死胡同比例
  - 美学规则 (15%): 美学平衡
- **评分计算**: 加权求和、分类评分、总体评分、等级评定
- **输出结果**: 详细报告、改进建议、JSON输出

**设计亮点**:
- 多维度评估体系
- 可配置的权重系统
- 详细的改进建议

## 系统设计优势

### 1. 高度模块化
- 每个组件职责单一，易于维护
- 组件间松耦合，支持独立开发和测试
- 插件化架构，便于功能扩展

### 2. 标准化处理
- 统一的数据格式，消除格式差异
- 标准化的评估指标，保证结果一致性
- 规范化的接口设计，便于集成

### 3. 智能化增强
- 空间推理自动补全连接信息
- 智能识别入口出口位置
- 多维度质量评估和优化建议

### 4. 可扩展性强
- 支持新的地下城生成器格式
- 支持新的质量评估指标
- 支持新的可视化方式
- 配置化的参数调整

## 技术栈
- **语言**: Python 3.x
- **架构模式**: 插件化架构、策略模式、工厂模式
- **数据处理**: JSON格式、图算法、空间几何
- **可视化**: Matplotlib、PIL
- **测试**: pytest

## 应用场景
1. **地下城生成器格式转换**: 支持多种格式的统一处理
2. **地图质量评估**: 多维度评估地下城设计质量
3. **设计优化建议**: 提供具体的改进建议
4. **批量处理**: 支持大规模地图文件的批量处理
5. **可视化展示**: 生成高质量的地图可视化图像 