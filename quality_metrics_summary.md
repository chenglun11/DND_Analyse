# 地牢质量评估指标总结

## 概述

本项目包含7个核心质量评估指标，用于全面评估地牢设计的质量。每个指标都采用科学的评分映射方法，确保评估结果的合理性和可解释性。

## 指标详情

### 1. Accessibility (可达性)
- **描述**: 评估房间间的连通性，衡量玩家在地牢中的移动自由度
- **评分方法**: 分段线性映射
- **理想区间**: 0.6 ~ 0.95 (满分)
- **参数设置**:
  - 0.6 ≤ avg_access ≤ 0.95: 满分1.0
  - avg_access < 0.6: 线性递增 (0.3 ~ 1.0)
  - avg_access > 0.95: 线性递减 (1.0 ~ 0.5)
- **复杂度因子**: min(1.0, 房间数/6.0)
- **优化建议**: 增加房间间的连接，减少孤立区域

### 2. Dead End Ratio (死胡同比例)
- **描述**: 评估地牢中死胡同房间的比例，越低越好
- **评分方法**: 线性递减映射
- **计算公式**: max(0.2, 1.0 - dead_end_ratio × 0.8)
- **参数说明**:
  - dead_end_ratio = 死胡同房间数 / 总房间数
  - 死胡同定义: 度为1的房间（只有一个连接）
- **优化建议**: 减少死胡同房间，增加房间连接数

### 3. Loop Ratio (回环率)
- **描述**: 评估地牢中回路结构的比例，适中最好
- **评分方法**: 高斯型映射
- **参数设置**:
  - 中心值(μ): 0.3
  - 标准差(σ): 0.3
  - 计算公式: exp(-((loop_ratio-0.3)²)/(2×0.3²))
- **理想范围**: 0.2 ~ 0.4
- **优化建议**: 保持适度的回路结构，避免过多或过少的回环

### 4. Degree Variance (度方差)
- **描述**: 评估房间连接数的方差，适中最好
- **评分方法**: 高斯型映射 + 复杂度因子
- **参数设置**:
  - 中心值(μ): 2.0
  - 标准差(σ): 1.5
  - 复杂度因子: min(1.0, 房间数/6.0)
- **理想范围**: 1.0 ~ 3.0
- **优化建议**: 平衡房间连接数，避免连接数过于集中或分散

### 5. Path Diversity (路径多样性)
- **描述**: 评估房间对之间可选路径的数量，适中最好
- **评分方法**: 高斯型映射
- **参数设置**:
  - 中心值(μ): 2.0
  - 标准差(σ): 1.0
  - 计算公式: exp(-((avg_path_diversity-2.0)²)/(2×1.0²))
- **算法说明**: 计算所有房间对之间的最短路径数量
- **特殊情况**: 无可达路径时返回基础分数0.3
- **优化建议**: 增加可选路径，提高地牢的探索性

### 6. Door Distribution (门分布)
- **描述**: 评估门在地牢中的分布均匀性
- **评分方法**: 线性映射
- **计算公式**: 1.0 - door_distribution_variance
- **优化建议**: 均匀分布门，避免过于集中或分散

### 7. Key Path Length (关键路径长度)
- **描述**: 评估地牢中关键路径的长度合理性
- **评分方法**: 分段线性映射
- **参数设置**:
  - 理想长度: 5 ~ 15
  - 可接受长度: 3 ~ 20
- **优化建议**: 保持关键路径长度在合理范围内

## 评分等级

- **A级 (0.8-1.0)**: 优秀设计
- **B级 (0.6-0.8)**: 良好设计
- **C级 (0.4-0.6)**: 一般设计
- **D级 (0.2-0.4)**: 较差设计
- **F级 (0.0-0.2)**: 需要改进

## 算法优化历史

### 初始版本问题
- 评分过于严苛，大量地牢得分过低
- 参数设置不合理，导致评分分布不均
- path_diversity算法存在bug，计算错误

### 优化改进
1. **放宽评分标准**: 扩大理想区间，降低惩罚力度
2. **修正算法错误**: 修复path_diversity的路径计算问题
3. **调整参数设置**: 使用更合理的σ值和映射函数
4. **增加容错处理**: 对特殊情况（如无路径）给予基础分数

## 使用建议

### 对于地牢设计者
1. **平衡各项指标**: 不要过分追求单一指标
2. **关注连通性**: 确保房间间有足够的连接
3. **适度复杂度**: 保持适度的回环和路径多样性
4. **避免极端**: 避免过多的死胡同或过于复杂的结构

### 对于评估者
1. **综合考量**: 结合多个指标进行整体评估
2. **考虑上下文**: 根据游戏类型调整权重
3. **迭代改进**: 基于评估结果持续优化设计

## 技术实现

### 核心依赖
- **numpy**: 数值计算
- **math**: 数学函数
- **collections**: 数据结构

### 文件结构
```
src/quality_rules/
├── base.py              # 基础类定义
├── accessibility.py     # 可达性评估
├── dead_end_ratio.py    # 死胡同比例
├── loop_ratio.py        # 回环率
├── degree_variance.py   # 度方差
├── path_diversity.py    # 路径多样性
├── door_distribution.py # 门分布
└── key_path_length.py   # 关键路径长度
```

### 扩展性
- 所有指标都继承自BaseQualityRule
- 易于添加新的评估指标
- 支持自定义评分规则和参数 