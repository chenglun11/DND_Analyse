{
  "header": {
    "schemaName": "dnd-dungeon-unified",
    "schemaVersion": "1.0.0",
    "name": "The Perpetual Engine",
    "author": "AJ Hunter (mapped to unified schema)",
    "description": "Looping challenge: clear rooms in the light order; safe room locks; portal-driven spawns; the visible ladder sits beyond a forever-locked door.",
    "grid": { "type": "square", "size": 5, "unit": "ft" }
  },
  "levels": [
    {
      "id": "level_main",
      "name": "Perpetual Engine (single layer with remote R7)",
      "map": { "width": 34, "height": 28 },

      "rooms": [
        { "id": "hub", "shape": "rectangle", "position": { "x": 11, "y": 11 }, "size": { "width": 4, "height": 4 }, "name": "Central Hub", "description": "Core junction with ever-seeing eye and progress lights." },
        { "id": "r1_east", "shape": "rectangle", "position": { "x": 18, "y": 11 }, "size": { "width": 7, "height": 6 }, "name": "R1", "description": "Room numbered 1." },
        { "id": "r2_west", "shape": "rectangle", "position": { "x": 1, "y": 11 }, "size": { "width": 7, "height": 6 }, "name": "R2", "description": "Room numbered 2." },
        { "id": "r3_north", "shape": "rectangle", "position": { "x": 11, "y": 19 }, "size": { "width": 4, "height": 6 }, "name": "R3", "description": "Room numbered 3; D7 at its north wall." },
        { "id": "r4_south", "shape": "rectangle", "position": { "x": 11, "y": 3 }, "size": { "width": 4, "height": 6 }, "name": "R4", "description": "Room numbered 4; hoard of treasure (illusion) visible from entrance." },
        { "id": "r5_ne", "shape": "rectangle", "position": { "x": 18, "y": 19 }, "size": { "width": 7, "height": 6 }, "name": "R5", "description": "Room numbered 5." },
        { "id": "r6_sw_safe", "shape": "rectangle", "position": { "x": 1, "y": 3 }, "size": { "width": 7, "height": 6 }, "name": "R6 (Safe Room)", "description": "Locks 10 minutes after entry; stays locked for 8 hours; merchant inside." },
        { "id": "entry_hall", "shape": "rectangle", "position": { "x": 11, "y": 0 }, "size": { "width": 4, "height": 3 }, "name": "Entrance Hall", "description": "Long sloping corridor to D1." },
        { "id": "r7_remote", "shape": "rectangle", "position": { "x": 26, "y": 18 }, "size": { "width": 5, "height": 5 }, "name": "R7 (Remote)", "description": "Somewhere else on the same layer; reachable only via portal O3." }
      ],

      "doors": [
        { "id": "D1", "position": { "x": 13, "y": 3, "dir": { "x": 0, "y": 1 }, "type": 3 }, "note": "Open at start; impossible to (re)open once it closes." },
        { "id": "D2", "position": { "x": 11, "y": 13, "dir": { "x": -1, "y": 0 }, "type": 1 }, "note": "Closes until R2 is cleared." },
        { "id": "D3", "position": { "x": 15, "y": 13, "dir": { "x": 1, "y": 0 }, "type": 1 }, "note": "Closes until R1 is cleared." },
        { "id": "D4", "position": { "x": 13, "y": 17, "dir": { "x": 0, "y": 1 }, "type": 1 }, "note": "Closes until R3 is cleared." },
        { "id": "D5", "position": { "x": 13, "y": 11, "dir": { "x": 0, "y": -1 }, "type": 1 }, "note": "Closes until R4 is cleared." },
        { "id": "D6", "position": { "x": 16, "y": 19, "dir": { "x": 1, "y": 0 }, "type": 1 }, "note": "Closes until R5 is cleared." },
        { "id": "D7", "position": { "x": 13, "y": 25, "dir": { "x": 0, "y": 1 }, "type": 9 }, "note": "Locked forever; no mechanism; a ladder (E2) is visible beyond." },
        { "id": "E3", "position": { "x": 1, "y": 13, "dir": { "x": -1, "y": 0 }, "type": 0 }, "note": "Regular outside door (flavor)." }
      ],

      "corridors": [
        { "id": "c_south", "shape": "rectangle", "position": { "x": 12, "y": 6 }, "size": { "width": 2, "height": 5 }, "name": "South Connector" },
        { "id": "c_north", "shape": "rectangle", "position": { "x": 12, "y": 16 }, "size": { "width": 2, "height": 3 }, "name": "North Connector" },
        { "id": "c_east", "shape": "rectangle", "position": { "x": 16, "y": 12 }, "size": { "width": 2, "height": 2 }, "name": "East Connector" },
        { "id": "c_west", "shape": "rectangle", "position": { "x": 10, "y": 12 }, "size": { "width": 1, "height": 2 }, "name": "West Connector" },
        { "id": "c_east_north", "shape": "rectangle", "position": { "x": 16, "y": 18 }, "size": { "width": 2, "height": 1 }, "name": "NE Connector" }
      ],

      "connections": [
        { "from_room": "entry_hall", "to_room": "c_south", "door_id": "D1", "connection_type": "door" },
        { "from_room": "c_south", "to_room": "hub", "inferred": true, "connection_type": "spatial_adjacency", "confidence": 0.95 },
        { "from_room": "hub", "to_room": "c_west", "inferred": true, "connection_type": "spatial_adjacency", "confidence": 0.95 },
        { "from_room": "hub", "to_room": "c_east", "inferred": true, "connection_type": "spatial_adjacency", "confidence": 0.95 },
        { "from_room": "hub", "to_room": "c_north", "inferred": true, "connection_type": "spatial_adjacency", "confidence": 0.95 },
        { "from_room": "c_west", "to_room": "r2_west", "door_id": "D2", "connection_type": "door" },
        { "from_room": "c_east", "to_room": "r1_east", "door_id": "D3", "connection_type": "door" },
        { "from_room": "hub", "to_room": "r4_south", "door_id": "D5", "connection_type": "door" },
        { "from_room": "c_north", "to_room": "r3_north", "door_id": "D4", "connection_type": "door" },
        { "from_room": "r3_north", "to_room": "c_east_north", "inferred": true, "connection_type": "spatial_adjacency", "confidence": 0.9 },
        { "from_room": "c_east_north", "to_room": "r5_ne", "door_id": "D6", "connection_type": "door" },
        { "from_room": "hub", "to_room": "r6_sw_safe", "inferred": true, "connection_type": "timed_lock", "note": "Locks after 10 min, 8h cooldown", "confidence": 0.8 },
        { "from_room": "r3_north", "to_room": "D7", "connection_type": "blocked_door" },
        { "from_room": "r2_west", "to_room": "outside_west", "door_id": "E3", "connection_type": "door" },
        { "from_room": "O3", "to_room": "r1_east", "connection_type": "portal" },
        { "from_room": "O3", "to_room": "r2_west", "connection_type": "portal" },
        { "from_room": "O3", "to_room": "r3_north", "connection_type": "portal" },
        { "from_room": "O3", "to_room": "r4_south", "connection_type": "portal" },
        { "from_room": "O3", "to_room": "r5_ne", "connection_type": "portal" },
        { "from_room": "O3", "to_room": "r6_sw_safe", "connection_type": "portal" },
        { "from_room": "O3", "to_room": "r7_remote", "connection_type": "portal" },
        { "from_room": "O5", "to_room": "D2", "connection_type": "logic_lock" },
        { "from_room": "O5", "to_room": "D3", "connection_type": "logic_lock" },
        { "from_room": "O5", "to_room": "D4", "connection_type": "logic_lock" },
        { "from_room": "O5", "to_room": "D5", "connection_type": "logic_lock" },
        { "from_room": "O5", "to_room": "D6", "connection_type": "logic_lock" }
      ],

      "game_elements": [
        { "id": "O1", "name": "Ever-Seeing Eye", "type": "special", "position": { "x": 13, "y": 13 }, "description": "The Necromancer watches through this eye." },
        { "id": "O2", "name": "Hoard of Treasure (Illusion)", "type": "treasure", "position": { "x": 13, "y": 5 }, "description": "Visible from D1; not real." },
        { "id": "O3", "name": "Inactive Portal", "type": "special", "position": { "x": 19, "y": 13 }, "description": "Activates via merchant's stone; summons monsters to rooms or transports to R7." },
        { "id": "O4", "name": "Kobold Merchant", "type": "npc", "position": { "x": 12, "y": 12 }, "description": "Trades rations/ammo for junk; holds the portal stone; attacking him summons his boss." },
        { "id": "O5", "name": "Progress Lights (10)", "type": "special", "position": { "x": 14, "y": 12 }, "description": "Ten lights indicate progress toward the sequence." },
        { "id": "E1", "name": "Entrance (sloping corridor)", "type": "entrance", "position": { "x": 13, "y": 1 }, "description": "Long corridor sloping down into the dungeon." },
        { "id": "E2", "name": "Ladder Up (behind D7)", "type": "exit", "position": { "x": 13, "y": 26 }, "description": "Visible but unreachable due to D7." },
        { "id": "E3_tag", "name": "Regular Door", "type": "exit", "position": { "x": 0, "y": 14 }, "description": "Plain door to outside tunnels." }
      ],

      "connections_inferred": true
    }
  ]
}